generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum CallDirection {
  INBOUND
  OUTBOUND
}

enum CallStatus {
  RECEIVED
  RINGING
  IN_PROGRESS
  COMPLETED
  FAILED
}

enum TaskStatus {
  PENDING
  SUCCESS
  FAILED
}

enum NotificationChannel {
  EMAIL
  TELEGRAM
}

enum NotificationStatus {
  PENDING
  SENT
  FAILED
}

model CallLog {
  id          String        @id @default(cuid())
  fromNumber  String
  toNumber    String
  provider    String
  direction   CallDirection
  status      CallStatus
  transcript  String?
  summary     String?
  metadata    Json?
  taskResults TaskResult[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

model TaskResult {
  id          String     @id @default(cuid())
  callId      String?
  call        CallLog?   @relation(fields: [callId], references: [id])
  name        String
  status      TaskStatus
  payload     Json?
  error       String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@index([callId])
}

model Notification {
  id          String             @id @default(cuid())
  channel     NotificationChannel
  destination String
  subject     String?
  message     String
  status      NotificationStatus
  error       String?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
}
